<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RIDESPHERE | POPKID</title>
<script src="https://cdn.tailwindcss.com"></script>

<style>
@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@900&family=Inter:wght@400;700&display=swap');

body {
    background:#020617;
    color:white;
    font-family:'Inter',sans-serif;
    overflow-x:hidden;
}

.neon-font { font-family:'Orbitron',sans-serif; }
.glass {
    background:rgba(15,23,42,0.9);
    backdrop-filter:blur(20px);
    border:1px solid rgba(255,255,255,0.1);
}
.neon-cyan {
    color:#22d3ee;
    text-shadow:0 0 15px rgba(34,211,238,0.6);
}
.btn-gradient {
    background:linear-gradient(90deg,#2563eb,#0891b2);
}

/* ðŸš— Car Animation */
@keyframes drive {
    0% { left:-200px; }
    100% { left:100%; }
}
.animate-car {
    position:absolute;
    bottom:10px;
    height:110px;
    animation:drive 6s linear infinite;
}
</style>
</head>

<body class="flex flex-col items-center justify-center min-h-screen p-4">

<!-- AUTH UI -->
<div id="auth-ui" class="glass p-10 rounded-[3rem] w-full max-w-sm text-center shadow-2xl border-t border-cyan-500/30">

<h1 class="neon-font neon-cyan text-3xl font-black italic mb-1">RIDESPHERE</h1>
<p class="text-slate-500 text-[9px] tracking-[0.3em] mb-8 uppercase font-bold">Popkid Edition</p>

<!-- SIGNUP -->
<form id="signup-form" class="space-y-4" onsubmit="event.preventDefault(); signUp();">
<input type="text" id="reg-username" name="username" placeholder="Username"
autocomplete="username"
class="w-full p-4 rounded-2xl bg-slate-900 border border-slate-800">

<input type="email" id="reg-email" name="email" placeholder="Email"
autocomplete="email"
class="w-full p-4 rounded-2xl bg-slate-900 border border-slate-800">

<input type="password" id="reg-password" name="password" placeholder="Password"
autocomplete="new-password"
class="w-full p-4 rounded-2xl bg-slate-900 border border-slate-800">

<button type="submit" class="btn-gradient w-full p-4 rounded-2xl font-black">
CREATE ACCOUNT
</button>

<p class="text-[10px] text-slate-500">
Already a driver?
<span class="text-cyan-400 cursor-pointer" onclick="toggleAuth()">Login</span>
</p>
</form>

<!-- LOGIN -->
<form id="login-form" class="hidden space-y-4" onsubmit="event.preventDefault(); login();">
<input type="email" id="login-email" name="email"
autocomplete="email"
placeholder="Email"
class="w-full p-4 rounded-2xl bg-slate-900 border border-slate-800">

<input type="password" id="login-password" name="password"
autocomplete="current-password"
placeholder="Password"
class="w-full p-4 rounded-2xl bg-slate-900 border border-slate-800">

<button type="submit" class="btn-gradient w-full p-4 rounded-2xl font-black">
SIGN IN
</button>

<p class="text-[10px] text-slate-500">
New driver?
<span class="text-cyan-400 cursor-pointer" onclick="toggleAuth()">Sign Up</span>
</p>
</form>
</div>

<!-- GARAGE UI -->
<div id="garage-ui" class="hidden w-full max-w-md">

<div class="flex justify-between items-end mb-6 px-2">
<div>
<h2 class="text-slate-500 text-[10px] uppercase font-bold">Verified Driver</h2>
<h1 id="user-display" class="neon-font text-2xl neon-cyan">...</h1>
</div>

<div class="glass px-6 py-3 rounded-2xl text-right">
<p class="text-[9px] text-slate-500 font-bold">BALANCE</p>
<p id="balance-display" class="text-green-400 font-black text-xl">Ksh 0</p>
</div>
</div>

<div class="glass rounded-[2.5rem] p-3">

<div class="relative w-full h-56 overflow-hidden rounded-[2rem] bg-slate-900 mb-6">
<img src="https://images.unsplash.com/photo-1503376780353-7e6692767b70?auto=format&fit=crop&w=800"
class="animate-car">
</div>

<button id="shift-btn" onclick="startShift()"
class="w-full p-6 rounded-3xl bg-white text-black font-black text-xl">
START SHIFT
</button>

</div>

<button onclick="logout()" class="w-full text-slate-600 text-[10px] mt-4 uppercase">
Sign Out
</button>

</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
getAuth,
createUserWithEmailAndPassword,
signInWithEmailAndPassword,
sendEmailVerification,
onAuthStateChanged,
signOut,
setPersistence,
browserLocalPersistence
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

import {
getFirestore,
doc,
setDoc,
onSnapshot,
updateDoc,
increment
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
apiKey: "YOUR_KEY",
authDomain: "YOUR_DOMAIN",
projectId: "YOUR_PROJECT_ID",
storageBucket: "YOUR_BUCKET",
messagingSenderId: "YOUR_SENDER_ID",
appId: "YOUR_APP_ID"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

setPersistence(auth, browserLocalPersistence);

let shiftInterval = null;
let unsubBalance = null;

window.toggleAuth = () => {
document.getElementById('signup-form').classList.toggle('hidden');
document.getElementById('login-form').classList.toggle('hidden');
};

window.signUp = async () => {
const email = reg-email.value;
const pass = reg-password.value;
const username = reg-username.value;

if(!email || !pass || !username) return alert("Fill all fields");

try{
const cred = await createUserWithEmailAndPassword(auth,email,pass);
await sendEmailVerification(cred.user);

await setDoc(doc(db,"drivers",cred.user.uid),{
username:username,
balance:12500,
car:"Toyota Crown"
});

alert("Verification email sent once. Verify then login.");
signOut(auth);
}catch(err){ alert(err.message); }
};

window.login = async () => {
try{
await signInWithEmailAndPassword(auth,login-email.value,login-password.value);
}catch(err){ alert(err.message); }
};

onAuthStateChanged(auth,(user)=>{
if(user){

if(!user.emailVerified){
alert("Please verify your email once.");
signOut(auth);
return;
}

auth-ui.classList.add("hidden");
garage-ui.classList.remove("hidden");

unsubBalance = onSnapshot(doc(db,"drivers",user.uid),(snap)=>{
if(snap.exists()){
user-display.innerText = snap.data().username;
balance-display.innerText = "Ksh " + snap.data().balance.toLocaleString();
}
});

}else{
if(unsubBalance) unsubBalance();
auth-ui.classList.remove("hidden");
garage-ui.classList.add("hidden");
}
});

window.startShift = async () => {

if(shiftInterval) return alert("Shift already running!");

const user = auth.currentUser;
if(!user) return;

shiftInterval = setInterval(()=>{
updateDoc(doc(db,"drivers",user.uid),{
balance: increment(50)
});
},60000);

shift-btn.innerText = "SHIFT RUNNING";
shift-btn.classList.remove("bg-white");
shift-btn.classList.add("bg-red-500");
};

window.logout = ()=>{
if(shiftInterval){
clearInterval(shiftInterval);
shiftInterval=null;
}
signOut(auth);
};

</script>

</body>
</html>
