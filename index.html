<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RideSphere Crash</title>

<style>
body{
  margin:0;
  font-family:Arial, sans-serif;
  background:linear-gradient(to top,#000428,#004e92);
  color:white;
  text-align:center;
}

.container{
  max-width:400px;
  margin:auto;
  padding:20px;
}

input{
  width:100%;
  padding:10px;
  margin:5px 0;
  border-radius:8px;
  border:none;
}

button{
  width:100%;
  padding:12px;
  margin:8px 0;
  border:none;
  border-radius:10px;
  background:#00ffcc;
  font-weight:bold;
  cursor:pointer;
  transition:0.3s;
}

button:hover{
  background:#00ffaa;
}

#game{
  display:none;
}

#car{
  font-size:60px;
  margin:20px;
  transition:transform 0.1s linear;
}

#multiplier{
  font-size:40px;
  margin:10px;
}

.balance{
  font-size:18px;
  margin:10px;
}

.crashed{
  color:red;
  transform:scale(1.5);
}
</style>
</head>
<body>

<div class="container">

<div id="auth">

<h2>RideSphere Crash</h2>

<input type="email" id="email" placeholder="Email">
<input type="password" id="password" placeholder="Password">

<button onclick="signup()">Sign Up</button>
<button onclick="login()">Login</button>
<button onclick="googleLogin()">Login with Gmail</button>
<button onclick="resetPassword()">Forgot Password</button>

<p id="authMsg"></p>

</div>

<div id="game">

<h2>ðŸš— Crash Game</h2>
<div class="balance">Balance: <span id="balance">0</span> Coins</div>

<input type="number" id="betAmount" placeholder="Enter Bet Amount">

<button onclick="startGame()">Start</button>
<button onclick="cashOut()">Cash Out</button>
<button onclick="logout()">Logout</button>

<div id="car">ðŸš—</div>
<div id="multiplier">1.00x</div>

</div>

</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword,
signOut, sendPasswordResetEmail, GoogleAuthProvider, signInWithPopup,
onAuthStateChanged, sendEmailVerification } 
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

import { getFirestore, doc, setDoc, getDoc, updateDoc } 
from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "YOUR_KEY",
  authDomain: "ridesphere-popkid.firebaseapp.com",
  projectId: "ridesphere-popkid",
  storageBucket: "ridesphere-popkid.firebasestorage.app",
  messagingSenderId: "476462103607",
  appId: "1:476462103607:web:27ec5a2134d5954ac113b2",
  measurementId: "G-QKZW353NZL"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

let currentUser;
let multiplier=1;
let crashPoint;
let interval;
let currentBet=0;

window.signup = async function(){
  const email=document.getElementById("email").value;
  const pass=document.getElementById("password").value;

  const user=await createUserWithEmailAndPassword(auth,email,pass);
  await sendEmailVerification(user.user);

  await setDoc(doc(db,"users",user.user.uid),{
    balance:1000
  });

  document.getElementById("authMsg").innerText="Verification email sent. Check Gmail.";
}

window.login = async function(){
  const email=document.getElementById("email").value;
  const pass=document.getElementById("password").value;

  const user=await signInWithEmailAndPassword(auth,email,pass);

  if(!user.user.emailVerified){
    alert("Verify your email first.");
    return;
  }
}

window.googleLogin = async function(){
  const provider=new GoogleAuthProvider();
  const result=await signInWithPopup(auth,provider);

  const docSnap=await getDoc(doc(db,"users",result.user.uid));
  if(!docSnap.exists()){
    await setDoc(doc(db,"users",result.user.uid),{balance:1000});
  }
}

window.resetPassword = async function(){
  const email=document.getElementById("email").value;
  await sendPasswordResetEmail(auth,email);
  alert("Reset link sent to Gmail.");
}

window.logout = function(){
  signOut(auth);
}

onAuthStateChanged(auth, async (user)=>{
  if(user){
    currentUser=user;
    document.getElementById("auth").style.display="none";
    document.getElementById("game").style.display="block";

    const docSnap=await getDoc(doc(db,"users",user.uid));
    document.getElementById("balance").innerText=docSnap.data().balance;
  }else{
    document.getElementById("auth").style.display="block";
    document.getElementById("game").style.display="none";
  }
});

window.startGame = async function(){
  const bet=parseInt(document.getElementById("betAmount").value);
  if(!bet)return alert("Enter bet");

  const userRef=doc(db,"users",currentUser.uid);
  const snap=await getDoc(userRef);
  let balance=snap.data().balance;

  if(bet>balance)return alert("Not enough balance");

  balance-=bet;
  await updateDoc(userRef,{balance});
  document.getElementById("balance").innerText=balance;

  currentBet=bet;
  multiplier=1;
  crashPoint=(Math.random()*4+1).toFixed(2);

  interval=setInterval(()=>{
    multiplier+=0.02;
    document.getElementById("multiplier").innerText=multiplier.toFixed(2)+"x";
    document.getElementById("car").style.transform="translateY(-"+multiplier*5+"px)";

    if(multiplier>=crashPoint){
      clearInterval(interval);
      document.getElementById("car").classList.add("crashed");
      currentBet=0;
    }
  },50);
}

window.cashOut = async function(){
  if(currentBet===0)return;

  clearInterval(interval);

  const win=currentBet*multiplier;
  const userRef=doc(db,"users",currentUser.uid);
  const snap=await getDoc(userRef);
  let balance=snap.data().balance+win;

  await updateDoc(userRef,{balance});
  document.getElementById("balance").innerText=balance;

  currentBet=0;
}

</script>
</body>
</html>
