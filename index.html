<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>RIDESPHERE | POPKID</title>
<script src="https://cdn.tailwindcss.com"></script>

<style>
@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@900&family=Inter:wght@400;700&display=swap');

body{
    background:#020617;
    color:white;
    font-family:'Inter',sans-serif;
    overflow-x:hidden;
}

.neon-font{font-family:'Orbitron',sans-serif;}
.glass{
    background:rgba(15,23,42,0.9);
    backdrop-filter:blur(20px);
    border:1px solid rgba(255,255,255,0.1);
}
.neon-cyan{
    color:#22d3ee;
    text-shadow:0 0 15px rgba(34,211,238,0.6);
}
.btn-gradient{
    background:linear-gradient(90deg,#2563eb,#0891b2);
}

/* Car animation */
@keyframes drive{
    0%{left:-180px;}
    100%{left:100%;}
}
.animate-car{
    position:absolute;
    bottom:10px;
    height:110px;
    animation:drive 6s linear infinite;
}
</style>
</head>

<body class="flex flex-col items-center justify-center min-h-screen p-4">

<!-- AUTH UI -->
<div id="auth-ui" class="glass p-10 rounded-[3rem] w-full max-w-sm text-center shadow-2xl border-t border-cyan-500/30">

<h1 class="neon-font neon-cyan text-3xl font-black italic mb-1">RIDESPHERE</h1>
<p class="text-slate-500 text-[9px] tracking-[0.3em] mb-8 uppercase font-bold">Popkid Edition</p>

<form id="signup-form" class="space-y-4">
<input type="text" id="reg-username" placeholder="Username"
class="w-full p-4 rounded-2xl bg-slate-900 border border-slate-800">

<input type="email" id="reg-email" placeholder="Email"
class="w-full p-4 rounded-2xl bg-slate-900 border border-slate-800">

<input type="password" id="reg-password" placeholder="Password"
class="w-full p-4 rounded-2xl bg-slate-900 border border-slate-800">

<button type="submit"
class="btn-gradient w-full p-4 rounded-2xl font-black">
CREATE ACCOUNT
</button>

<p class="text-[10px] text-slate-500">
Already a driver?
<button type="button" id="switch-to-login"
class="text-cyan-400 font-bold ml-1">
Login
</button>
</p>
</form>

<form id="login-form" class="hidden space-y-4">
<input type="email" id="login-email"
placeholder="Email"
class="w-full p-4 rounded-2xl bg-slate-900 border border-slate-800">

<input type="password" id="login-password"
placeholder="Password"
class="w-full p-4 rounded-2xl bg-slate-900 border border-slate-800">

<button type="submit"
class="btn-gradient w-full p-4 rounded-2xl font-black">
SIGN IN
</button>

<p class="text-[10px] text-slate-500">
New driver?
<button type="button" id="switch-to-signup"
class="text-cyan-400 font-bold ml-1">
Sign Up
</button>
</p>
</form>
</div>

<!-- GARAGE UI -->
<div id="garage-ui" class="hidden w-full max-w-md">

<div class="flex justify-between items-end mb-6 px-2">
<div>
<h2 class="text-slate-500 text-[10px] uppercase font-bold">Verified Driver</h2>
<h1 id="user-display" class="neon-font text-2xl neon-cyan">...</h1>
</div>

<div class="glass px-6 py-3 rounded-2xl text-right">
<p class="text-[9px] text-slate-500 font-bold">BALANCE</p>
<p id="balance-display" class="text-green-400 font-black text-xl">Ksh 0</p>
</div>
</div>

<div class="glass rounded-[2.5rem] p-3">

<div class="relative w-full h-56 overflow-hidden rounded-[2rem] bg-slate-900 mb-6">
<img src="https://images.unsplash.com/photo-1503376780353-7e6692767b70?auto=format&fit=crop&w=800"
class="animate-car">
</div>

<button id="shift-btn"
class="w-full p-6 rounded-3xl bg-white text-black font-black text-xl">
START SHIFT
</button>

</div>

<button id="logout-btn"
class="w-full text-slate-600 text-[10px] mt-4 uppercase">
Sign Out
</button>

</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import {
getAuth,
createUserWithEmailAndPassword,
signInWithEmailAndPassword,
sendEmailVerification,
onAuthStateChanged,
signOut,
setPersistence,
browserLocalPersistence
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";

import {
getFirestore,
doc,
setDoc,
onSnapshot,
updateDoc,
increment
} from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDe8i7FOSmuWCUhqwLXb9nBDWQKSIBKJpw",
  authDomain: "ridesphere-popkid.firebaseapp.com",
  projectId: "ridesphere-popkid",
  storageBucket: "ridesphere-popkid.firebasestorage.app",
  messagingSenderId: "476462103607",
  appId: "1:476462103607:web:27ec5a2134d5954ac113b2",
  measurementId: "G-QKZW353NZL"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

await setPersistence(auth, browserLocalPersistence);

let shiftInterval = null;
let unsubBalance = null;

document.addEventListener("DOMContentLoaded", () => {

const signupForm = document.getElementById("signup-form");
const loginForm = document.getElementById("login-form");

document.getElementById("switch-to-login").onclick = () => {
signupForm.classList.add("hidden");
loginForm.classList.remove("hidden");
};

document.getElementById("switch-to-signup").onclick = () => {
loginForm.classList.add("hidden");
signupForm.classList.remove("hidden");
};

signupForm.addEventListener("submit", async (e)=>{
e.preventDefault();

const username = reg-username.value;
const email = reg-email.value;
const pass = reg-password.value;

if(!username || !email || !pass) return alert("Fill all fields");

try{
const cred = await createUserWithEmailAndPassword(auth,email,pass);
await sendEmailVerification(cred.user);

await setDoc(doc(db,"drivers",cred.user.uid),{
username,
balance:12500,
car:"Toyota Crown"
});

alert("Verification email sent. Verify then login.");
await signOut(auth);
}catch(err){alert(err.message);}
});

loginForm.addEventListener("submit", async (e)=>{
e.preventDefault();
try{
await signInWithEmailAndPassword(
auth,
login-email.value,
login-password.value
);
}catch(err){alert(err.message);}
});

document.getElementById("shift-btn").onclick = ()=>{
if(shiftInterval) return;

const user = auth.currentUser;
if(!user) return;

shiftInterval = setInterval(()=>{
updateDoc(doc(db,"drivers",user.uid),{
balance: increment(50)
});
},60000);

const btn = document.getElementById("shift-btn");
btn.innerText = "SHIFT RUNNING";
btn.classList.remove("bg-white");
btn.classList.add("bg-red-500");
};

document.getElementById("logout-btn").onclick = ()=>{
if(shiftInterval){
clearInterval(shiftInterval);
shiftInterval=null;
}
signOut(auth);
};

});

onAuthStateChanged(auth,(user)=>{
const authUI = document.getElementById("auth-ui");
const garageUI = document.getElementById("garage-ui");

if(user){

if(!user.emailVerified){
alert("Verify your email first.");
signOut(auth);
return;
}

authUI.classList.add("hidden");
garageUI.classList.remove("hidden");

unsubBalance = onSnapshot(doc(db,"drivers",user.uid),(snap)=>{
if(snap.exists()){
user-display.innerText = snap.data().username;
balance-display.innerText =
"Ksh " + snap.data().balance.toLocaleString();
}
});

}else{
if(unsubBalance) unsubBalance();
authUI.classList.remove("hidden");
garageUI.classList.add("hidden");
}
});

</script>
</body>
</html>
